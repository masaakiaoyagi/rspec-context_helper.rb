# RSpec::ContextHelper

https://github.com/mkenney/software-guides/blob/master/STABILITY-BADGES.md#work-in-progress[image:https://img.shields.io/badge/stability-wip-lightgrey.svg[stability-wip]]
https://github.com/masaakiaoyagi/rspec-context_helper.rb/actions/workflows/test.yml[image:https://github.com/masaakiaoyagi/rspec-context_helper.rb/actions/workflows/test.yml/badge.svg[test]]
https://opensource.org/licenses/MIT[image:https://img.shields.io/badge/License-MIT-yellow.svg[License: MIT]]

This helper library is for writing tests concisely.

You can write a test as follows.
```ruby
example_with("value is zero", value: 0) { expect(value).to eq 0 }
```
Above is the same as below.
```ruby
context "value is zero" do
  let(:value) { 0 }
  it { expect(value).to eq 0 }
end
```

That's basically all there is to it, but I think it will be more potent when used with a https://relishapp.com/rspec/rspec-expectations/v/3-11/docs/custom-matchers[custom matcher].

.Example of ActiveModel validation tests using a custom matcher
[%collapsible]
====
```ruby
class Account
  include ActiveModel::Model
  include ActiveModel::Attributes
  attribute :name, :string
  validates :name, presence: true, length: { in: 3..20 }, format: { with: /\A[0-9a-zA-Z]*\z/, message: "alphanumeric characters only" }
end

let(:account) { Account.new(name: name) }
before do
  account.valid?
end

# There is no "have_error" matcher, so you need to create one.
example_with(name: " ")      { expect(account).to have_error.on(:name).with(:blank) }
example_with(name: "a" * 2)  { expect(account).to have_error.on(:name).with(:too_short, count: 3) }
example_with(name: "a" * 3)  { expect(account).not_to have_error }
example_with(name: "a" * 20) { expect(account).not_to have_error }
example_with(name: "a" * 21) { expect(account).to have_error.on(:name).with(:too_long, count: 20) }
example_with(name: "a0a")    { expect(account).not_to have_error }
example_with(name: "a a")    { expect(account).to have_error.on(:name).with(:invalid) }
example_with(name: "a@a")    { expect(account).to have_error.on(:name).with("alphanumeric characters only") }
```
====

## Installation

. Add the dependency to your `Gemfile`:

    ```ruby
    group :test do
      gem "rspec-context_helper"
    end
    ```

. Run `bundle install`

## Usage

```ruby
require "rspec-context_helper"
```

See https://github.com/masaakiaoyagi/rspec-context_helper.rb/blob/main/spec/rspec/context_helper_spec.rb[spec] how to write a test.

## Development

### Run tests
```sh
$ docker compose run --rm 3.1 bundle exec rspec
```

## See also
* https://github.com/rspec/rspec-metagem[RSpec]
* https://github.com/masaakiaoyagi/spectator-context_helper.cr[Crystal version]
